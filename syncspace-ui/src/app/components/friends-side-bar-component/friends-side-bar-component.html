<!-- Friends/DM Sidebar -->
<div id="friends-sidebar" 
     class="w-60 bg-discord-sidebar flex flex-col md:relative fixed left-0 top-0 h-full z-50 
            transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-out 
            shadow-discord">
    
    <!-- Header -->
    <div class="h-12 border-b border-discord-darkest/60 px-4 flex items-center shadow-sm">
        <div class="flex items-center flex-1">
            <svg class="w-6 h-6 mr-3 text-discord-text" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 
                         10-4.48 10-10S17.52 2 12 2zm0 3
                         c1.66 0 3 1.34 3 3s-1.34 3-3 
                         3-3-1.34-3-3 1.34-3 3-3zm0 
                         14.2c-2.5 0-4.71-1.28-6-3.22
                         .03-1.99 4-3.08 6-3.08 
                         1.99 0 5.97 1.09 6 3.08
                         -1.29 1.94-3.5 3.22-6 3.22z"/>
            </svg>
            <span class="font-semibold text-white brand-font">Friends</span>
        </div>
        <button class="p-1.5 hover:bg-discord-light rounded btn-hover" onclick="openNewDM()" title="Create DM">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
        </button>
    </div>

    <!-- Search -->
    <div class="p-3">
        <div class="relative">
            <input 
                type="text" 
                placeholder="Find or start a conversation"
                class="w-full bg-discord-darkest text-sm px-3 py-2 rounded-md 
                       border-none outline-none text-discord-text 
                       placeholder-discord-text-dark"
                id="search-input"
            >
            <svg class="w-4 h-4 absolute right-3 top-3 text-discord-text-muted" fill="currentColor" viewBox="0 0 24 24">
                <path d="M15.5 14h-.79l-.28-.27
                         C15.41 12.59 16 11.11 16 9.5 
                         16 5.91 13.09 3 9.5 3S3 5.91 
                         3 9.5 5.91 16 9.5 16c1.61 0 
                         3.09-.59 4.23-1.57l.27.28v.79l5 
                         4.99L20.49 19l-4.99-5zm-6 
                         0C7.01 14 5 11.99 5 9.5S7.01 
                         5 9.5 5 14 7.01 14 9.5 
                         11.99 14 9.5 14z"/>
            </svg>
        </div>
    </div>

    <!-- Direct Messages List -->
    <div class="flex-1 overflow-y-auto custom-scrollbar">
        <div class="px-2">
            
            <!-- Direct Messages Header -->
            <div class="flex items-center justify-between px-2 py-1 mx-2 
                        text-xs font-semibold text-discord-text-dark uppercase tracking-wide 
                        hover:text-discord-text cursor-pointer group">
                <div class="flex items-center">
                    <svg class="w-3 h-3 mr-1 transition-transform duration-150 group-hover:rotate-90" 
                         fill="currentColor" viewBox="0 0 24 24">
                        <path d="M7 14l5-5 5 5z"/>
                    </svg>
                    Direct Messages
                </div>
                <button class="p-1 hover:text-discord-text opacity-0 group-hover:opacity-100 transition-opacity" title="Create DM">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                </button>
            </div>

            <!-- DM Conversations -->
            <div class="space-y-0.5 px-2">
                <ng-container *ngFor="let chat of chats()">
                    <div 
                        [routerLink]="`/app/dm/${chat.channel.id}`" 
                        [queryParams]="{ user:chat.user.id }"
                        class="flex items-center px-2 py-2 rounded-md cursor-pointer 
                               hover:bg-discord-light/30 transition-colors duration-150 group"
                    >
                        <!-- Avatar + Status -->
                        <div class="relative mr-3 flex-shrink-0">
                            <img 
                                [src]="chat.user.avatarUrl" 
                                alt="User Avatar" 
                                class="w-9 h-9 rounded-full object-cover border border-discord-dark shadow-sm"
                            />
                            <div 
                                class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 border-2 border-discord-sidebar rounded-full" 
                                [ngClass]="'status-' + chatStatus(chat.user.isOnline)">
                            </div>
                        </div>

                        <!-- Chat Info -->
                        <div class="flex-1 min-w-0 pr-2">
                            <div class="flex items-center justify-between mb-0.5">
                                <span class="text-sm font-medium text-white truncate">
                                    {{ chat.user.username }}
                                </span>
                                @if (chat.channel.lastReadMessage != null) {
                                    <span class="ml-2 text-xs text-discord-text-muted whitespace-nowrap flex-shrink-0">
                                        {{ chat.channel.lastReadMessage.sentAt }}
                                    </span>
                                }
                            </div>
                            @if (chat.channel.lastReadMessage != null) {
                                <p class="text-xs text-discord-text-muted truncate leading-tight">
                                    {{ chat.channel.lastReadMessage.content }}
                                </p>
                            }
                        </div>

                        <!-- Unread Badge -->
                        @if (chat.channel.unReadMessages > 0) {
                            <div class="flex-shrink-0 ml-2">
                                <span class="inline-flex items-center justify-center min-w-[18px] h-[18px] 
                                           bg-discord-red text-white text-xs font-semibold 
                                           px-1.5 rounded-full leading-none">
                                    {{ chat.channel.unReadMessages }}
                                </span>
                            </div>
                        }
                    </div>
                </ng-container>
            </div>
        </div>
    </div>

    <!-- User Area -->
    <app-user-area-component></app-user-area-component>
</div>