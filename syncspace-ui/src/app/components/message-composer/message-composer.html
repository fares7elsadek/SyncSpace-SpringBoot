<div class="p-4">
  <div class="bg-[#2b2d31] rounded-lg border border-[#1e1f22] shadow-lg transition-all duration-200 ease-in-out"
       [class.shadow-xl]="content.trim().length > 0">
    
    <!-- Main composer area -->
    <div class="flex items-end p-3 gap-2">
      
      <!-- Upload button -->
      <button
        class="flex-shrink-0 p-2 hover:bg-[#404249] rounded-lg transition-all duration-150 ease-in-out group"
        title="Upload File">
        <svg class="w-5 h-5 text-[#b5bac1] group-hover:text-[#dbdee1] transition-colors" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
      </button>

      <!-- Dynamic textarea container -->
      <div class="flex-1 relative bg-[#383a40] rounded-lg border border-[#1e1f22] 
                  focus-within:border-[#5865f2] transition-all duration-200 ease-in-out
                  hover:border-[#4752c4] min-h-[44px] max-h-[200px]"
           [class.border-[#5865f2]]="isTextareaFocused">
        
        <!-- Textarea with dynamic sizing -->
        <textarea
          #messageTextarea
          [(ngModel)]="content"
          (keydown)="handleKeyDown($event)"
          (focus)="isTextareaFocused = true"
          (blur)="isTextareaFocused = false"
          (input)="adjustTextareaHeight()"
          [placeholder]="`Message ${chatName()}`"
          class="w-full bg-transparent text-[#dbdee1] placeholder-[#87898c] 
                 resize-none outline-none p-3 leading-5 text-[15px]
                 scrollbar-thin scrollbar-thumb-[#1e1f22] scrollbar-track-transparent
                 transition-all duration-200 ease-in-out min-h-[20px] max-h-[154px]"
          rows="1"
          style="field-sizing: content; overflow-y: hidden;"
        ></textarea>

        <!-- Character count (optional, shows when approaching limit) -->
        <div *ngIf="content.length > 1800" 
             class="absolute bottom-1 right-2 text-xs"
             [class.text-[#f23f42]]="content.length > 2000"
             [class.text-[#faa61a]]="content.length > 1800 && content.length <= 2000"
             [class.text-[#87898c]]="content.length <= 1800">
          {{ 2000 - content.length }}
        </div>
      </div>

      <!-- Action buttons -->
      <div class="flex items-center gap-1 flex-shrink-0">
        
        <!-- Emoji button -->
        <button 
          class="p-2 hover:bg-[#404249] rounded-lg transition-all duration-150 ease-in-out group"
          title="Add Emoji">
          <svg class="w-5 h-5 text-[#b5bac1] group-hover:text-[#dbdee1] transition-colors" fill="currentColor" viewBox="0 0 24 24">
            <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
          </svg>
        </button>

        <!-- Send button with loading state -->
        <button
          (click)="sendMessage()"
          [disabled]="!canSend() || !content.trim()"
          class="p-2 rounded-lg transition-all duration-150 ease-in-out group relative overflow-hidden"
          [class.bg-[#5865f2]]="content.trim() && !isSending()"
          [class.hover:bg-[#4752c4]]="content.trim() && !isSending()"
          [class.bg-[#404249]]="!content.trim() || isSending()"
          [class.cursor-not-allowed]="!canSend() || !content.trim() || isSending()"
          title="Send Message (Enter or Ctrl+Enter)">
          
          <!-- Send icon -->
          <svg *ngIf="!isSending()" 
               class="w-5 h-5 transition-colors duration-150"
               [class.text-white]="content.trim()"
               [class.text-[#87898c]]="!content.trim()"
               fill="currentColor" viewBox="0 0 24 24">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
          
          <!-- Loading spinner -->
          <svg *ngIf="isSending()" 
               class="w-5 h-5 text-white animate-spin" 
               fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Bottom hints with typing indicator space -->
    <div class="px-3 pb-2">
      
      <!-- Typing indicator (placeholder for future feature) -->
      <div *ngIf="false" class="mb-1 text-xs text-[#87898c] flex items-center gap-1">
        <div class="flex gap-1">
          <div class="w-1 h-1 bg-[#87898c] rounded-full animate-bounce" style="animation-delay: 0ms"></div>
          <div class="w-1 h-1 bg-[#87898c] rounded-full animate-bounce" style="animation-delay: 150ms"></div>
          <div class="w-1 h-1 bg-[#87898c] rounded-full animate-bounce" style="animation-delay: 300ms"></div>
        </div>
        <span>Someone is typing...</span>
      </div>

      <!-- Shortcut hints -->
      <div class="text-xs text-[#87898c] flex items-center justify-between">
        <div>
          Press <kbd class="bg-[#1e1f22] px-1.5 py-0.5 rounded text-xs border border-[#404249] font-mono">Enter</kbd> to send, 
          <kbd class="bg-[#1e1f22] px-1.5 py-0.5 rounded text-xs border border-[#404249] font-mono">Shift + Enter</kbd> for newline
        </div>
        
        <!-- Word/character count for longer messages -->
        <div *ngIf="content.length > 100" class="text-[#87898c]">
          {{ getWordCount() }} words
        </div>
      </div>
    </div>
  </div>
</div>